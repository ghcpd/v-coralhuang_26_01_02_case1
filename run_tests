#!/usr/bin/env bash
set -euo pipefail

# Create venv if missing
if [ ! -d .venv ]; then
  python -m venv .venv
fi

# Try to activate (works on many POSIX environments and Git Bash on Windows)
if [ -f .venv/bin/activate ]; then
  # shellcheck disable=SC1091
  . .venv/bin/activate
elif [ -f .venv/Scripts/activate ]; then
  # Git for Windows / MSYS / Git Bash
  # shellcheck disable=SC1091
  . .venv/Scripts/activate
fi

python -m pip install --upgrade pip
python -m pip install -q pytest pytest-asyncio
python -m pytest -q
